# 留言板系统 API 接口设计文档

## 1. 文档说明

### 1.1 接口规范



* 遵循 RestFul API 设计规范，使用 HTTP 方法表达操作语义（GET/POST/PUT/DELETE）；

* 身份认证：所有需登录的接口均需在请求头携带`Authorization: Bearer {JWT令牌}`；

* 数据格式：请求 / 响应均为 JSON 格式，编码 UTF-8；

* 状态码：使用标准 HTTP 状态码，配合自定义业务码返回结果；

* 时间格式：所有时间字段均为毫秒级时间戳。

### 1.2 通用响应格式



```
{

  "code": 200, // 业务码：200-成功 400-参数错误 401-未授权 403-权限不足 500-服务器错误

  "msg": "操作成功", // 提示信息

  "data": {} // 业务数据（可选）

}
```

### 1.3 权限说明



* 匿名接口：无需登录即可访问（如用户登录、留言列表查询）；

* 普通用户接口：需登录且角色为 0（如发表留言、回复、点赞、举报）；

* 管理员接口：需登录且角色为 1（如审核举报、停用留言）。

## 2. 认证相关接口

### 2.1 用户注册



* **接口路径**：`/api/users/register`

* **请求方法**：POST

* **权限**：匿名

* **请求参数**：



| 参数名   | 类型   | 必填 | 注释                  |
| -------- | ------ | ---- | --------------------- |
| email    | string | 是   | 用户邮箱（唯一）      |
| nickname | string | 是   | 用户昵称（长度 1-32） |
| password | string | 是   | 密码（建议加密传输）  |



* **响应示例**：



```
{

  "code": 200,

  "msg": "注册成功",

  "data": {

    "userId": 1001,

    "nickname": "测试用户"

  }

}
```

### 2.2 用户登录



* **接口路径**：`/api/users/login`

* **请求方法**：POST

* **权限**：匿名

* **请求参数**：



| 参数名   | 类型   | 必填 | 注释     |
| -------- | ------ | ---- | -------- |
| email    | string | 是   | 用户邮箱 |
| password | string | 是   | 用户密码 |



* **响应示例**：



```
{

  "code": 200,

  "msg": "登录成功",

  "data": {

    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // JWT令牌，有效期7天

    "userInfo": {

      "id": 1001,

      "nickname": "测试用户",

      "role": 0 // 0-普通用户 1-管理员

    }

  }

}
```

### 2.3 获取当前用户信息



* **接口路径**：`/api/users/current`

* **请求方法**：GET

* **权限**：需登录

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "id": 1001,

    "email": "test@example.com",

    "nickname": "测试用户",

    "role": 0,

    "status": 0,

    "createTime": 1735689600000

  }

}
```

## 3. 留言相关接口

### 3.1 分页查询留言列表



* **接口路径**：`/api/messages`

* **请求方法**：GET

* **权限**：匿名

* **请求参数（Query）**：



| 参数名   | 类型   | 必填 | 默认值 | 注释                                            |
| -------- | ------ | ---- | ------ | ----------------------------------------------- |
| pageNum  | int    | 否   | 1      | 页码                                            |
| pageSize | int    | 否   | 10     | 每页条数                                        |
| sortType | string | 否   | "hot"  | 排序类型：hot - 热度（点赞 + 时间） time - 最新 |
| keyword  | string | 否   | -      | 搜索关键词（匹配标题 / 内容）                   |



* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "total": 100, // 总条数

    "list": [

      {

        "id": 2001,

        "title": "测试留言标题",

        "content": "测试留言内容...",

        "likeCount": 10,

        "creatorId": 1001,

        "creatorNickname": "测试用户",

        "createTime": 1735689600000,

        "status": 0,

        "replyCount": 5 // 回复数

      }

    ]

  }

}
```

### 3.2 获取单条留言详情



* **接口路径**：`/api/messages/{messageId}`

* **请求方法**：GET

* **权限**：匿名

* **路径参数**：`messageId` - 留言 ID

* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "id": 2001,

    "title": "测试留言标题",

    "content": "测试留言内容（富文本）",

    "likeCount": 10,

    "creatorId": 1001,

    "creatorNickname": "测试用户",

    "createTime": 1735689600000,

    "updateTime": 1735689600000,

    "status": 0,

    "isLiked": false // 当前登录用户是否点赞（未登录为false）

  }

}
```

### 3.3 发表留言



* **接口路径**：`/api/messages`

* **请求方法**：POST

* **权限**：普通用户

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **请求参数**：



| 参数名  | 类型   | 必填 | 注释                   |
| ------- | ------ | ---- | ---------------------- |
| title   | string | 是   | 留言标题（长度 1-128） |
| content | string | 是   | 留言内容（支持富文本） |



* **响应示例**：



```
{

  "code": 200,

  "msg": "发表成功",

  "data": {

    "messageId": 2001

  }

}
```

### 3.4 编辑留言



* **接口路径**：`/api/messages/{messageId}`

* **请求方法**：PUT

* **权限**：留言创建者

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`messageId` - 留言 ID

* **请求参数**：



| 参数名  | 类型   | 必填 | 注释                   |
| ------- | ------ | ---- | ---------------------- |
| title   | string | 是   | 留言标题（长度 1-128） |
| content | string | 是   | 留言内容（支持富文本） |



* **响应示例**：



```
{

  "code": 200,

  "msg": "编辑成功",

  "data": {

    "updateTime": 1735690000000

  }

}
```

### 3.5 删除留言



* **接口路径**：`/api/messages/{messageId}`

* **请求方法**：DELETE

* **权限**：留言创建者 / 管理员

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`messageId` - 留言 ID

* **响应示例**：



```
{

  "code": 200,

  "msg": "删除成功"

}
```

### 3.6 管理员修改留言状态



* **接口路径**：`/api/messages/{messageId}/status`

* **请求方法**：PUT

* **权限**：管理员

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`messageId` - 留言 ID

* **请求参数**：



| 参数名 | 类型 | 必填 | 注释                               |
| ------ | ---- | ---- | ---------------------------------- |
| status | int  | 是   | 状态：-2 - 违规 -1 - 停用 0 - 正常 |



* **响应示例**：



```
{

  "code": 200,

  "msg": "状态修改成功"

}
```

## 4. 回复相关接口

### 4.1 分页查询留言回复



* **接口路径**：`/api/messages/{messageId}/replies`

* **请求方法**：GET

* **权限**：匿名

* **路径参数**：`messageId` - 留言 ID

* **请求参数（Query）**：



| 参数名   | 类型 | 必填 | 默认值 | 注释     |
| -------- | ---- | ---- | ------ | -------- |
| pageNum  | int  | 否   | 1      | 页码     |
| pageSize | int  | 否   | 20     | 每页条数 |



* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "total": 5,

    "list": \[

      {

        "id": 3001,

        "messageId": 2001,

        "content": "测试回复内容",

        "creatorId": 1002,

        "creatorNickname": "回复用户",

        "parentId": null, // 无父回复（直接回复留言）

        "createTime": 1735689800000,

        "children": \[ // 二级回复

          {

            "id": 3002,

            "content": "测试二级回复",

            "creatorNickname": "二级回复用户",

            "parentId": 3001,

            "createTime": 1735689900000

          }

        ]

      }

    ]

  }

}
```

### 4.2 发表回复



* **接口路径**：`/api/replies`

* **请求方法**：POST

* **权限**：普通用户

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **请求参数**：



| 参数名    | 类型   | 必填 | 注释                                                 |
| --------- | ------ | ---- | ---------------------------------------------------- |
| messageId | int    | 是   | 所属留言 ID                                          |
| parentId  | int    | 否   | 父回复 ID（NULL - 直接回复留言，非 NULL - 多级回复） |
| content   | string | 是   | 回复内容                                             |



* **响应示例**：



```
{

  "code": 200,

  "msg": "回复成功",

  "data": {

    "replyId": 3001

  }

}
```

### 4.3 删除回复



* **接口路径**：`/api/replies/{replyId}`

* **请求方法**：DELETE

* **权限**：回复创建者 / 管理员

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`replyId` - 回复 ID

* **响应示例**：



```
{

  "code": 200,

  "msg": "删除成功"

}
```

## 5. 点赞相关接口

### 5.1 点赞 / 取消点赞留言



* **接口路径**：`/api/messages/{messageId}/like`

* **请求方法**：POST

* **权限**：普通用户

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`messageId` - 留言 ID

* **请求参数**：



| 参数名   | 类型 | 必填 | 注释                                             |
| -------- | ---- | ---- | ------------------------------------------------ |
| isCancel | bool | 否   | 是否取消：false - 点赞 true - 取消（默认 false） |



* **响应示例**：



```
{

  "code": 200,

  "msg": "点赞成功",

  "data": {

    "likeCount": 11 // 最新点赞数

  }

}
```

### 5.2 查询用户点赞状态



* **接口路径**：`/api/messages/{messageId}/like/status`

* **请求方法**：GET

* **权限**：需登录

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`messageId` - 留言 ID

* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "isLiked": true // 是否已点赞

  }

}
```

## 6. 举报相关接口

### 6.1 举报留言



* **接口路径**：`/api/reports`

* **请求方法**：POST

* **权限**：普通用户

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **请求参数**：



| 参数名    | 类型   | 必填 | 注释                 |
| --------- | ------ | ---- | -------------------- |
| messageId | int    | 是   | 被举报留言 ID        |
| reason    | string | 是   | 举报原因（1-256 字） |



* **响应示例**：



```
{

  "code": 200,

  "msg": "举报成功，等待管理员审核",

  "data": {

    "reportId": 4001

  }

}
```

### 6.2 管理员查询举报列表



* **接口路径**：`/api/admin/reports`

* **请求方法**：GET

* **权限**：管理员

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **请求参数（Query）**：



| 参数名      | 类型 | 必填 | 默认值 | 注释                                             |
| ----------- | ---- | ---- | ------ | ------------------------------------------------ |
| pageNum     | int  | 否   | 1      | 页码                                             |
| pageSize    | int  | 否   | 10     | 每页条数                                         |
| auditStatus | int  | 否   | -1     | 审核状态：-1 - 全部 0 - 待审核 1 - 通过 2 - 驳回 |



* **响应示例**：



```
{

  "code": 200,

  "msg": "查询成功",

  "data": {

    "total": 10,

    "list": \[

      {

        "id": 4001,

        "messageId": 2001,

        "messageTitle": "测试留言标题",

        "reporterNickname": "举报用户",

        "reason": "违规内容举报",

        "createTime": 1735690000000,

        "auditStatus": 0,

        "auditUserNickname": "",

        "auditTime": null

      }

    ]

  }

}
```

### 6.3 管理员审核举报



* **接口路径**：`/api/admin/reports/{reportId}/audit`

* **请求方法**：PUT

* **权限**：管理员

* **请求头**：`Authorization: Bearer {JWT令牌}`

* **路径参数**：`reportId` - 举报 ID

* **请求参数**：



| 参数名      | 类型   | 必填 | 注释                        |
| ----------- | ------ | ---- | --------------------------- |
| auditStatus | int    | 是   | 审核状态：1 - 通过 2 - 驳回 |
| remark      | string | 否   | 审核备注（可选）            |



* **响应示例**：



```
{

  "code": 200,

  "msg": "审核成功"

}
```

## 7. 异常码说明



| 业务码 | 说明           | 解决方案                                  |
| ------ | -------------- | ----------------------------------------- |
| 400    | 参数错误       | 检查请求参数是否符合格式 / 必填要求       |
| 401    | 未授权         | 登录获取有效 JWT 令牌，或检查令牌是否过期 |
| 403    | 权限不足       | 确认用户角色是否具备接口访问权限          |
| 404    | 资源不存在     | 检查留言 / 回复 / 举报 ID 是否正确        |
| 409    | 重复操作       | 如重复点赞、重复注册邮箱                  |
| 500    | 服务器内部错误 | 联系管理员排查服务端问题                  |
